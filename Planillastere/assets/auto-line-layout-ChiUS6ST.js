import{l as M}from"./index-BXg7HVPT.js";function T(){return 1}function z(i,s){if(!i||i<=0)return 0;const a=Math.round(i*(isFinite(s)?s:1));return Math.max(0,a)}const l={marginX:0,marginY:0,stationSpacingX:820,operatorSpacingY:220,bufferOffsetX:420,bufferWidth:280,getBufferY:(i,s,a)=>s+(i-1)*a/2},X=[{id:"station-00",type:"material_preparation",name:"PreparaciÃ³n"},{id:"station-01",type:"soldering",name:"Soldado"},{id:"station-02",type:"chinese_tester",name:"Tester Chino"},{id:"station-03",type:"inprocess_test",name:"Test IPT"},{id:"station-04",type:"transparent_termo",name:"Termo Transparente"},{id:"station-05",type:"filament",name:"Filamento"},{id:"station-06",type:"white_termo",name:"Blanco"},{id:"station-07",type:"burning",name:"Quemado"},{id:"station-08",type:"cushions",name:"Almohadillas"},{id:"station-09",type:"rubber",name:"Engomado"},{id:"station-10",type:"final_functionality_test",name:"Test Final"},{id:"station-11",type:"packaging",name:"Empaque"}];function Y(i){return{material_preparation:"preparacion",soldering:"soldadura",chinese_tester:"testing",inprocess_test:"testing",transparent_termo:"termo",filament:"ensamblaje",white_termo:"termo",burning:"ensamblaje",cushions:"ensamblaje",rubber:"ensamblaje",final_functionality_test:"testing",packaging:"empaque"}[i]??"todos"}function $(i,s){const a=M(),c=[],f=[],P=T();let h=0,y=0,u=l.marginX;const C=l.marginY,m=[];X.forEach(({id:e,type:r})=>{const o=i.stations.find(p=>p.stationId===e),t=a.stations[r];if(!t){console.warn(`ConfiguraciÃ³n no encontrada para: ${r}`);return}const g=o?.operarios||t.defaultOperators||0,n=z(g,P);if(n>0){const p=l.getBufferY(n,C,l.operatorSpacingY);m.push({stationType:r,stationConfig:t,operatorCount:n,moduleIds:[],centerY:p,startX:u}),y+=n,u+=l.stationSpacingX}}),u=l.marginX,m.forEach((e,r)=>{const{stationType:o,stationConfig:t,operatorCount:g}=e;for(let n=0;n<g;n++){const p=Date.now()+h,S=`${o}-op${n+1}-${p}`,d={id:S,name:`${t.name} #${n+1}`,category:Y(o),position:{x:u,y:C+n*l.operatorSpacingY},status:"inactivo",connections:[],description:t.name,icon:"ðŸ‘·",operatorsCount:1,timePerUnit:t.baseCycleTime??0,unitsPerHour:t.baseUPH??0,preparationTime:0,velocity:t.baseUPH?Math.round(t.baseUPH/60):0,failureRate:0,actualPerformance:100,totalProcessed:0,efficiency:95+Math.random()*5,isTemplate:!1,operatorId:`OP-${o}-${n+1}`,stationType:o,throughput:t.baseUPH,hasInput:!["material_preparation"].includes(o),hasOutput:!["packaging"].includes(o),hasRework:["chinese_tester","inprocess_test","final_functionality_test"].includes(o),rollSize:t.batchSize??void 0,receivedRolls:0,sentRolls:0};d.rollSize&&d.rollSize>0?d.cadenceAccumulator=Math.random()*d.rollSize:d.cadenceAccumulator=0,c.push(d),e.moduleIds.push(S),h++}u+=l.stationSpacingX}),m.forEach((e,r)=>{if(!(r===m.length-1)){const t=m[r+1],g=Date.now()+h+5e4+r,n=`buffer-${e.stationType}-to-${t.stationType}-${g}`,p=e.startX+l.bufferOffsetX,S=e.centerY,I={id:n,name:"Buffer",category:"todos",position:{x:p,y:S},status:"activo",connections:[],description:"Buffer intermedio",icon:"ðŸ“¦",operatorsCount:0,timePerUnit:0,unitsPerHour:0,preparationTime:0,velocity:0,failureRate:0,actualPerformance:100,totalProcessed:0,efficiency:100,isTemplate:!1,operatorId:`BUFFER-${r}`,stationType:"buffer",throughput:0,hasInput:!0,hasOutput:!0,hasRework:!1,rollSize:e.stationConfig.batchSize??10,receivedRolls:0,sentRolls:0,isBuffer:!0,bufferCapacity:a.buffer.defaultCapacity,currentBuffer:0,bufferStatus:"normal"};c.push(I),h++,e.moduleIds.forEach(b=>{f.push({id:`conn-${b}-to-${n}`,fromModuleId:b,toModuleId:n,connectionType:"normal",flowRate:e.stationConfig.baseUPH,bufferSize:a.buffer.defaultCapacity,durability:100,isBottleneck:!1,rollSize:e.stationConfig.batchSize??void 0,currentRolls:0,accumulatedUnits:0,rollsPerHour:e.stationConfig.batchSize?Math.floor(e.stationConfig.baseUPH/e.stationConfig.batchSize):0})}),t.moduleIds.forEach(b=>{f.push({id:`conn-${n}-to-${b}`,fromModuleId:n,toModuleId:b,connectionType:"normal",flowRate:t.stationConfig.baseUPH,bufferSize:a.buffer.defaultCapacity,durability:100,isBottleneck:!1,rollSize:t.stationConfig.batchSize??void 0,currentRolls:0,accumulatedUnits:0,rollsPerHour:t.stationConfig.batchSize?Math.floor(t.stationConfig.baseUPH/t.stationConfig.batchSize):0})})}});const _=c.filter(e=>e.isBuffer).length;return{modules:c,connections:f,totalOperators:y,bufferCount:_}}function U(i){if(i.length===0)return{centerX:0,centerY:0,suggestedScale:1};let s=1/0,a=-1/0,c=1/0,f=-1/0;i.forEach(o=>{s=Math.min(s,o.position.x),a=Math.max(a,o.position.x),c=Math.min(c,o.position.y),f=Math.max(f,o.position.y)});const P=(s+a)/2,h=(c+f)/2,y=a-s+400,u=f-c+400,C=1400,m=800,_=C/y,e=m/u,r=Math.min(_,e,1);return{centerX:P,centerY:h,suggestedScale:Math.max(.3,r)}}export{U as calculateOptimalViewport,$ as generateProductionLineLayout};
